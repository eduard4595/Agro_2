<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot de Cultivo de Maíz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #EAEAEA;
            color: #3C3C3C;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #004F73;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        header img {
            height: 90px;
        }
        .ticker-container {
            background-color: #76A728;
            color: white;
            padding: 10px;
            font-size: 1em;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .ticker {
            overflow: hidden;
            white-space: nowrap;
        }
        .ticker span {
            display: inline-block;
            padding-left: 30%;
            animation: ticker 280s linear infinite;
        }
        @keyframes ticker {
            from { transform: translateX(10%); }
            to { transform: translateX(-100%); }
        }
        .main-container {
            display: flex;
            flex: 1;
            flex-direction: row;
        }
        .tools-container {
            background-color: #004F73;
            color: white;
            width: 200px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
        }
        .tools-container a {
            background-color: #D9A404;
            color: white;
            text-decoration: none;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .tools-container a:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
        }
        .content-container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .highlight-btn {
            background-color: #D9A404;
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 10px;
            max-width: 400px;
            margin: 0 auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .chat-container {
            flex: 1;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .chat-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        .chat-box {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            background-color: #f9f9f9;
            flex: 1;
            white-space: normal; /* Para evitar que el texto se divida */
            word-wrap: break-word;
        }
        .chat-input {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            min-width: 0;
        }
        .chat-input button {
            padding: 10px 20px;
            background-color: #76A728;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .chat-input button:hover {
            background-color: #D9A404;
        }
        footer {
            text-align: center;
            padding: 10px;
            background-color: #004F73;
            color: white;
        }

        /* Media Queries para diseño responsivo */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .tools-container {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            .tools-container a {
                flex: 1 1 200px;
                max-width: 250px;
            }
            header img {
                height: 70px;
            }
            .highlight-btn {
                font-size: 1.2em;
                padding: 12px;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }
            header h1 {
                font-size: 1.5em;
                margin: 10px 0;
            }
            header img {
                height: 60px;
            }
            .ticker-container {
                font-size: 0.9em;
            }
            .chat-box {
                height: 200px;
            }
            .highlight-btn {
                font-size: 1em;
                max-width: 300px;
            }
            .tools-container a {
                padding: 10px;
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 10px;
            }
            header img {
                height: 50px;
            }
            .ticker-container {
                font-size: 0.8em;
            }
            .content-container {
                padding: 10px;
            }
            .chat-container {
                padding: 10px;
            }
            .chat-box {
                height: 150px;
            }
            .chat-input {
                flex-direction: column;
            }
            .chat-input input {
                width: 100%;
            }
            .chat-input button {
                width: 100%;
                padding: 10px;
            }
            .highlight-btn {
                font-size: 0.9em;
                padding: 10px;
                max-width: 100%;
            }
            .tools-container {
                padding: 10px;
            }
            .tools-container a {
                flex: 1 1 100%;
                max-width: none;
            }
        }
        

        #userInput {
            width: 70%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: inline-block;
        }
        #sendBtn {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        .suggestion {
            border: 1px solid #ccc;
            padding: 5px;
            margin-top: 5px;
            cursor: pointer;
            background-color: #f1f1f1;
        }
        .suggestion:hover {
            background-color: #ddd;
        }
        #autocomplete-suggestions {
            width: 70%;
            border: 1px solid #ccc;
            position: absolute;
            z-index: 1;
            background-color: #fff;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 5px;
        }
        .welcome-message {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }
        .thinking-message {
            font-style: italic;
            color: #777;
        }
        .dot {
            font-size: 30px; /* Tamaño más grande de los puntos */
            animation: dot-blink 1s steps(1, end) infinite; /* Animación de parpadeo de puntos */
        }
        @keyframes dot-blink {
            0% { content: "."; }
            33% { content: ".."; }
            66% { content: "..."; }
            100% { content: "."; }
        }
        .info-buttons-container {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
        margin-bottom: 20px;
    }

    .info-left, .info-right {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .highlight-btn {
        background-color: #D9A404;
        color: white;
        text-align: center;
        padding: 10px;
        font-size: 1em;
        font-weight: bold;
        border-radius: 10px;
        max-width: 200px;
        margin-top: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .highlight-btn a {
        color: white;
        text-decoration: none;
    }
    </style>
</head>
<body>
    <header>
        <!-- Botón para Ir al Panel General -->
        <a href="{{ url_for('main.index') }}" class="btn" style="background-color: #004F73; color: white; text-decoration: none; font-size: 1em; display: flex; align-items: center;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" style="width: 24px; height: 24px; margin-right: 5px;">
                <path d="M15 19l-7-7 7-7"/>
            </svg>
            Ir al Panel General
        </a>
      <h1 style="text-align: center;">Plataforma de Gestión Agrícola</h1>
      <img src="{{ url_for('static', filename='logo_Asistec.png') }}" alt="Logo Asistec" style="height: 90px;"> <!-- Ajuste del tamaño -->
      <!-- Botón para Sign Out -->
      <a href="{{ url_for('logout') }}" class="btn" style="background-color: #004F73; color: white; text-decoration: none; font-size: 1em;">
        Salir
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" style="width: 24px; height: 24px; margin-left: 5px;">
            <path d="M16 13v-2H7V8l-5 4 5 4v-3h9z"/>
            <path d="M20 3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H4V5h16v14z"/>
        </svg>
    </a>
    </header>
    <div class="ticker-container">
      <h2 style="text-align: center;">Precios de Café en grano por kg por Estado</h2>
        <div class="ticker">
            <span>
                06/03/2025 - Colima: Precio Mín $256.00 Precio Max $262.00 Precio Frec $259.00 |
                06/03/2025 - Chiapas: Precio Mín $300.00 Precio Max $345.00 Precio Frec $322.50 |
                06/03/2025 - Guerrero: Precio Mín $245.00 Precio Max $270.00 Precio Frec $256.66 |
                06/03/2025 - Veracruz: Precio Mín $310.00 Precio Max $350.00 Precio Frec $328.00 |
                06/03/2025 - Puebla: Precio Mín $290.00 Precio Max $360.00 Precio Frec $344.38 |
                06/03/2025 - Querétaro: Precio Mín $457.00 Precio Max $476.00 Precio Frec $466.50
            </span>
        </div>
    </div>
    <div class="main-container">
        <div class="tools-container">
            <a href="{{ url_for('financial_statements_cafe') }}" class="btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                    <rect x="3" y="4" width="18" height="16" rx="2" ry="2" stroke="white" stroke-width="2" fill="none"></rect>
                    <line x1="3" y1="10" x2="21" y2="10" stroke="white" stroke-width="2"></line>
                </svg>
                Ver Estados Financieros
            </a>
            <a href="{{ url_for('database_access_cafe') }}" class="btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                    <ellipse cx="12" cy="5" rx="9" ry="3" stroke="white" stroke-width="2" fill="none"></ellipse>
                    <path d="M3 5v6c0 1.5 4 3 9 3s9-1.5 9-3V5" stroke="white" stroke-width="2" fill="none"></path>
                    <path d="M3 11v6c0 1.5 4 3 9 3s9-1.5 9-3v-6" stroke="white" stroke-width="2" fill="none"></path>
                </svg>
                Acceso a Base de Datos
            </a>
            <a href="{{ url_for('my_analysis_cafe') }}" class="btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                    <path d="M3 17h18v2H3v-2zm0-5h12v2H3v-2zm0-5h8v2H3V7z"/>
                </svg>
                Análisis Histórico
            </a>
            <a href="{{ url_for('climatico') }}" class="btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                    <path d="M19 16.95c1.73 0 3.14-1.41 3.14-3.14 0-1.73-1.41-3.14-3.14-3.14-.26 0-.52.03-.77.08-.53-2.33-2.61-4.08-5.1-4.08-2.49 0-4.57 1.75-5.1 4.08-.25-.05-.51-.08-.77-.08-1.73 0-3.14 1.41-3.14 3.14 0 1.73 1.41 3.14 3.14 3.14H19zm-6.5 3.05c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-4 0c-.83 0-1.5-.67-1.5-1.5S7.67 17 8.5 17s1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm8 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path>
                </svg>
                Centro de Alerta Climática
            </a>
          
        </div>
        <div class="content-container">
            <div class="info-buttons-container">
                <!-- Botón a la izquierda -->
                <div class="info-left">
                    <p style="text-align: left;">Aquí podrás registrar tus finanzas y procesos</p>
                    <div class="highlight-btn">
                        <a href="{{ url_for('coffee_form') }}" style="color: white; text-decoration: none;">Responder Cuestionario</a>
                    </div>
                </div>
            
                <!-- Botón a la derecha -->
                <div class="info-right">
                    <p style="text-align: left;">Solicita una asesoría remota especializada</p>
                    <div class="highlight-btn">
                        <a href="{{ url_for('my_analysis_cafe') }}" style="color: white; text-decoration: none;">Agendar Asesoría</a>
                    </div>
                </div>
            </div>            
            <div class="chat-container">
                <h2> AI Chat Agropecuario AgroAsistec</h2>
                <div class="chat-box" id="chat-box">
                     Mensajes del chat aparecerán aquí 
                </div>
                <div class="chat-input">
                    <div id="chatbox"></div>
                        <div class="welcome-message">Bienvenido a AgroAsistec Cafetalero</div>
                        <input type="text" id="userInput" list="autocomplete-suggestions" placeholder="Escribe tu pregunta..." autocomplete="off">
                        <!--Se agrego este datalist reemplazando el div de sugerencias-->
                        <datalist id="autocomplete-suggestions">
                            
                        </datalist>
                        <button id="sendBtn">Enviar</button>
                    </div>
                </div>
            </div>    

        </div>
    </div>
    <footer>
        <p>Desarrollado por Ciencia de Datos México. Todos los derechos reservados.</p>
    </footer>

    
    
    <script>
        const preguntasRespuestas = [
           { 
            pregunta: "¿Por qué es importante conocer las variedades de café antes de sembrar?", 
            respuesta: "¡Hola, qué bueno que preguntas! Es clave identificar las variedades porque cada una tiene características y manejos distintos, ya que el café es un cultivo a largo plazo que inicia cosecha a los 6 años y produce hasta 20. Conocerlas te ayuda a planificar inversión y cuidados. Esto asegura que elijas una variedad adecuada a tu clima y suelo, maximizando la producción y evitando sorpresas. ¿Qué más te interesa aprender sobre el café?", 
        },
        { 
            pregunta: "¿Cuántas semillas de café hay por kilo en promedio?", 
            respuesta: "¡Saludos, amante del café! En promedio, hay 3500 semillas por kilo, aunque esto varía según la variedad elegida para la siembra. Es un dato útil para calcular cuánta semilla necesitas por hectárea, considerando que se seleccionan plantas en cada etapa. Así, puedes prepararte mejor para el cultivo y garantizar un buen inicio. ¿Cómo puedo ayudarte con tu proyecto cafetero?", 
        },
        { 
            pregunta: "¿Cuánta semilla necesito para sembrar una hectárea de café?", 
            respuesta: "¡Hey, qué gran pregunta! Con 1.5 kilos de semilla basta para una hectárea, pero debes tener más plantas de las que siembras porque se hacen selecciones en semillero y vivero. Esto asegura que solo las mejores lleguen a la parcela, optimizando tu inversión y esfuerzo. ¿Qué otros detalles necesitas para planificar tu siembra?", 
        },
        { 
            pregunta: "¿En qué mes se recomienda sembrar las semillas de café?", 
            respuesta: "¡Hola, amigo cafetero! La siembra se recomienda en marzo para que las plantas estén listas para trasplantar en septiembre, cuando comienzan las lluvias abundantes sin vientos fuertes. Esto fortalece las raíces y mejora su resistencia a sequías, dándoles un arranque sólido. ¿Qué más quieres saber sobre el ciclo del café?", 
        },
        { 
            pregunta: "¿Qué requisitos debe cumplir una semilla de café comprada?", 
            respuesta: "¡Qué bueno verte por aquí! Debe ser certificada, de alta producción y resistente a la roya, cumpliendo las leyes agrícolas para evitar plagas y enfermedades en tu zona. Esto garantiza calidad y seguridad, protegiendo tu cultivo desde el inicio con una base confiable. ¿Te gustaría saber más sobre cómo elegir semillas?", 
        },
        { 
            pregunta: "¿Cómo se debe almacenar la semilla de café?", 
            respuesta: "¡Hola, qué alegría ayudarte! Guárdala en un lugar fresco, seco, ventilado y libre de patógenos; ya viene protegida contra plagas si es certificada. Un buen almacenamiento preserva su viabilidad, asegurando que germine fuerte y sana para tu futura cosecha. ¿Qué otro consejo necesitas para empezar bien?", 
        },
        { 
            pregunta: "¿Dónde se debe establecer el semillero de café?", 
            respuesta: "¡Saludos, cultivador! El semillero va en un lugar plano con 5% de pendiente para evitar inundaciones, cerca de agua para riegos fáciles. Esto facilita el manejo y protege las plántulas, dándoles un entorno ideal para crecer sin estrés. ¿Cómo puedo apoyarte con tu semillero?", 
        },
        { 
            pregunta: "¿Qué dimensiones debe tener un semillero de café?", 
            respuesta: "¡Hey, qué bueno que lo preguntas! Debe tener 1 metro de alto (20 cm de sustrato), 120 cm de ancho y 5 metros de largo, ajustable según la cantidad de plantas. Estas medidas optimizan el drenaje y el espacio, asegurando un desarrollo saludable desde el inicio. ¿Qué más te gustaría planificar?", 
        },
        { 
            pregunta: "¿Qué materiales se pueden usar para construir un semillero?", 
            respuesta: "¡Hola, entusiasta del café! Puedes usar madera local o bloques con cemento, rellenando con 60 cm de piedra grande, 20 cm de piedra pequeña y 20 cm de sustrato. Esto mejora el drenaje y evita hongos, creando un ambiente perfecto para las plántulas. ¿Qué dudas tienes sobre la construcción?", 
        },
        { 
            pregunta: "¿Qué tipo de sustrato se usa en el semillero de café?", 
            respuesta: "¡Qué alegría charlar contigo! El sustrato debe ser arenoso para buen drenaje, mezclado con ceniza o tratado con agua hirviendo para desinfectarlo el día de la siembra. Esto facilita la extracción de plántulas y reduce riesgos de enfermedades, asegurando un inicio sano. ¿Qué más te intriga del proceso?", 
        },
        { 
            pregunta: "¿Cómo se prepara la semilla de café antes de sembrarla?", 
            respuesta: "¡Saludos, qué buena consulta! Remójala en agua un día o unas horas antes, desecha las que floten y siembra solo las que se hunden, colocándolas en canales de 5 cm. Este paso asegura que uses semillas viables, mejorando la germinación y el éxito del cultivo. ¿Cómo puedo guiarte más en esto?", 
        },
        { 
            pregunta: "¿Qué se hace con la semilla después de colocarla en el semillero?", 
            respuesta: "¡Hola, qué gusto ayudarte! Tápala con sustrato, cúbrela con plástico 15 días para mantener temperatura, luego usa ramas y un techado de hojas o zacate para sombra. Esto protege los brotes y favorece un crecimiento uniforme, clave para plántulas fuertes. ¿Qué otro paso te interesa conocer?", 
        },
        { 
            pregunta: "¿Cuánto tarda en germinar la semilla de café?", 
            respuesta: "¡Hey, excelente pregunta! Germina entre 45 y 55 días, tiempo en el que debes vigilar plagas como insectos u hongos para proteger las plántulas. Revisar constantemente asegura que cualquier problema se detecte a tiempo, manteniendo tu cultivo en buen camino. ¿Qué más quieres explorar sobre la germinación?", 
        },
        {
            pregunta: "¿Cuál es la mejor forma de sembrar café?",
            respuesta: `
                ¡Qué excelente pregunta! Sembrar café correctamente requiere una planificación cuidadosa y atención a los detalles. 
                Primero, selecciona una variedad de café adecuada para tu clima y tipo de suelo. 
                Asegúrate de preparar el terreno eliminando malezas y mejorando la fertilidad del suelo con abonos orgánicos. 
                Luego, establece un semillero en un lugar con sombra parcial y buen drenaje, utilizando sustrato arenoso para facilitar el desarrollo de las raíces. 
                Una vez que las plántulas tengan entre 20 y 30 cm de altura, trasplántalas al campo en hoyos de 40x40x40 cm, dejando una distancia de 2x2 metros entre plantas. 
                Riega regularmente y protege las plantas jóvenes de plagas y enfermedades. 
                Para más detalles, te recomiendo ver este video que explica el proceso paso a paso: 
                "https://www.youtube.com/watch?v=TOkgI5gF3oI&ab_channel=CIDATMEX">Cómo sembrar café correctamente.
                  
            ` }
        ];       

        const respuestasDivertidas = [
        { 
            interaccion: "Hola", 
            respuesta: "¡Hola, qué tal! Más feliz que un cafetalero con lluvia suave. ¿En qué te ayudo con tu café hoy?" 
        },
        { 
            interaccion: "¿Cómo estás?", 
            respuesta: "¡Saludos! Mejor que un grano recién tostado. ¿Cómo te ayudo con tu pasión cafetera?" 
        }
        
    ];

    const chatbox = document.getElementById("chatbox");
        const userInput = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const autocompleteSuggestions = document.getElementById("autocomplete-suggestions");

        function showMessage(message, sender, isBold = false) {
            const messageElement = document.createElement("p");
            if (isBold) {
                messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`; // Permitir HTML y aplicar negritas al remitente
            } else {
                messageElement.innerHTML = `${sender}: ${message}`; // Permitir HTML en el mensaje
            }
            chatbox.appendChild(messageElement);
            chatbox.scrollTop = chatbox.scrollHeight; // Desplaza hacia abajo automáticamente
        }


        function typingEffect(message, sender) {
            const messageElement = document.createElement("p");
            messageElement.textContent = `<strong>${sender}</strong>: `; // La respuesta se mantiene en una sola línea.
            chatbox.appendChild(messageElement);
            chatbox.scrollTop = chatbox.scrollHeight;

            let i = 0;
            let interval = setInterval(() => {
                messageElement.textContent = `${sender}: ${message.slice(0, i++)}`; // Agregar letra por letra en la misma línea.
                if (i > message.length) clearInterval(interval);
            }, 40); // 40ms para cada letra
        }

        function getBestAnswer(userQuestion) {
            // Buscar coincidencias exactas en preguntasRespuestas
            for (let item of preguntasRespuestas) {
                if (userQuestion.toLowerCase() === item.pregunta.toLowerCase()) {
                    return item.respuesta; // Coincidencia exacta
                }
            }

            // Buscar coincidencias con al menos un 70% de similitud en respuestasDivertidas
            for (let item of respuestasDivertidas) {
                let similarity = calculateSimilarity(userQuestion, item.interaccion);
                if (similarity >= 0.7) { // Umbral de similitud del 70%
                    return item.respuesta;
                }
            }

            // Si no hay coincidencias, devolver la respuesta general
            return "Lo siento, no tengo una respuesta para esa pregunta. Estamos trabajando para mejorar nuestras respuestas y ampliar el contenido. ¿Hay algo más en lo que pueda ayudarte?";
        }

        function calculateSimilarity(str1, str2) {
            str1 = str1.toLowerCase();
            str2 = str2.toLowerCase();

            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;

            const longerLength = longer.length;
            if (longerLength === 0) return 1.0;

            const editDistance = getEditDistance(longer, shorter);
            return (longerLength - editDistance) / longerLength;
        }

        function getEditDistance(str1, str2) {
            const matrix = Array.from({ length: str2.length + 1 }, () => Array(str1.length + 1).fill(0));

            for (let i = 0; i <= str1.length; i++) matrix[0][i] = i;
            for (let j = 0; j <= str2.length; j++) matrix[j][0] = j;

            for (let j = 1; j <= str2.length; j++) {
                for (let i = 1; i <= str1.length; i++) {
                    const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;
                    matrix[j][i] = Math.min(
                        matrix[j - 1][i] + 1, // Eliminación
                        matrix[j][i - 1] + 1, // Inserción
                        matrix[j - 1][i - 1] + cost // Sustitución
                    );
                }
            }

            return matrix[str2.length][str1.length];
        }

        /*Nueva funcion para mostrar posibles preguntas al chat, se reemplazo el div por un detalist con sus opciones*/
        function updateDatalist(userQuestion) {
            const datalist = document.getElementById("autocomplete-suggestions");
            datalist.innerHTML = ""; // Limpiar opciones previas
            if (userQuestion.trim() === "") return;
        
            // Dividir la pregunta en palabras y obtener la última
            const words = userQuestion.split(" ");
            const lastWord = words[words.length - 1].toLowerCase();
        
            // Filtrar las sugerencias basadas en la última palabra
            const suggestions = preguntasRespuestas.filter(item =>
                item.pregunta.toLowerCase().includes(lastWord)
            );
        
            // Agregar hasta 5 opciones al datalist
            suggestions.slice(0, 5).forEach(item => {
                const option = document.createElement("option");
                option.value = item.pregunta;
                datalist.appendChild(option);
            });
        }        

        sendBtn.addEventListener("click", () => {
            const userQuestion = userInput.value.trim();
            if (userQuestion) {
                // Mostrar la pregunta del usuario primero
                showMessage(userQuestion, "Usuario", true); // Pregunta en negritas

                // Procesar la respuesta después de un breve retraso
                setTimeout(() => {
                    const response = getBestAnswer(userQuestion);
                    typingEffect(response, "AgroAsistec AI"); // Mostrar la respuesta con efecto de escritura
                }, 500); // Espera breve antes de mostrar la respuesta

                // Limpiar el campo de entrada y sugerencias
                userInput.value = "";
                autocompleteSuggestions.innerHTML = "";
            }
        });

        userInput.addEventListener("input", () => {
            updateDatalist(userInput.value);
        });        

        userInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                sendBtn.click();
            }
        });

        // Mensaje de bienvenida
        showMessage("Hola, bienvenido a AgroAsistec tu asistente inteligente. ¿Cómo puedo ayudarte hoy?", "AgroAsistec");
    </script>
</body>
</html>
